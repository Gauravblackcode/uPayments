{"ast":null,"code":"import axios from \"axios\";\nimport { getData, removeData } from \"../../utils/asyncKeyStorage\";\nimport history from \"./customHistory\";\nimport { showErrorMessage, showSuccessMessage, showLoadingIndicator, hideLoadingIndicator } from \"../../utils/utils\";\nconst BASE_URL = process.env.REACT_APP_BASE_URL;\nlet activeRequests = 0;\nconst appClient = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\n\nconst onSuccess = res => {\n  hideLoader();\n  const {\n    data\n  } = res;\n\n  if (data !== null && data !== void 0 && data.message) {\n    showSuccessMessage(data === null || data === void 0 ? void 0 : data.message);\n  } else {\n    removeToken(data === null || data === void 0 ? void 0 : data.statusCode);\n    showErrorMessage((data === null || data === void 0 ? void 0 : data.message) || \"Network error\");\n  }\n\n  return (res === null || res === void 0 ? void 0 : res.data) || res;\n};\n\nconst onError = err => {\n  var _err$response, _err$response2;\n\n  hideLoader();\n  console.log(err === null || err === void 0 ? void 0 : err.response, \"err?.response\");\n  const {\n    status\n  } = (err === null || err === void 0 ? void 0 : err.response) || {};\n  const {\n    viewModel,\n    message,\n    statusCode\n  } = (err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || {};\n  removeToken(status);\n  showErrorMessage((err === null || err === void 0 ? void 0 : err.message) || \"Network error\");\n  console.log(\"wori\", statusCode, status);\n\n  if ((status || statusCode) == (405 || 500)) {\n    return history.replace(\"/500\");\n  }\n\n  return err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.data;\n};\n\nconst hideLoader = () => {\n  activeRequests--;\n\n  if (!activeRequests) {\n    hideLoadingIndicator();\n  }\n};\n\nconst showLoader = () => {\n  activeRequests++;\n  showLoadingIndicator();\n};\n\nconst removeToken = statusCode => {\n  if (statusCode === 401 || statusCode === 403) {\n    removeData(\"accessToken\");\n    window.location.href = \"/auth\";\n  }\n};\n\nexport const apiRequest = async (options, auth) => {\n  showLoader(); // const token = await getData(\"accessToken\");\n\n  const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImdhdXJhdmJsYWNrY29kZUBnbWFpbC5jb20iLCJnaXRodWIiOiJodHRwczovL2dpdGh1Yi5jb20vR2F1cmF2YmxhY2tjb2RlIiwiaWF0IjoxNjU5MzQ4MDk5LCJleHAiOjE2NTk3ODAwOTl9.bUGO31givjMT85QyKzC3V9iKdiwMQgE9pqEwZ5yZBxI';\n  appClient.defaults.headers[\"Authorization\"] = `Bearer ${token}`;\n  return appClient(options).then(onSuccess).catch(onError);\n};\nexport const apiRequestWithoutToken = async options => {\n  showLoader();\n  return appClient(options).then(onSuccess).catch(onError);\n};","map":{"version":3,"names":["axios","getData","removeData","history","showErrorMessage","showSuccessMessage","showLoadingIndicator","hideLoadingIndicator","BASE_URL","process","env","REACT_APP_BASE_URL","activeRequests","appClient","create","baseURL","headers","onSuccess","res","hideLoader","data","message","removeToken","statusCode","onError","err","console","log","response","status","viewModel","replace","showLoader","window","location","href","apiRequest","options","auth","token","defaults","then","catch","apiRequestWithoutToken"],"sources":["/home/mark/Desktop/jobs/upayments/src/services/network/api.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { getData, removeData } from \"../../utils/asyncKeyStorage\";\r\nimport history from \"./customHistory\";\r\nimport {\r\n  showErrorMessage,\r\n  showSuccessMessage,\r\n  showLoadingIndicator,\r\n  hideLoadingIndicator,\r\n} from \"../../utils/utils\";\r\n\r\nconst BASE_URL = process.env.REACT_APP_BASE_URL;\r\nlet activeRequests = 0;\r\n\r\nconst appClient = axios.create({\r\n  baseURL: BASE_URL,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\nconst onSuccess = (res) => {\r\n  hideLoader();\r\n  const { data } = res;\r\n  if (data?.message) {\r\n    showSuccessMessage(data?.message);\r\n  } else {\r\n    removeToken(data?.statusCode);\r\n    showErrorMessage(data?.message || \"Network error\");\r\n  }\r\n  return res?.data || res;\r\n};\r\n\r\nconst onError = (err) => {\r\n  hideLoader();\r\n  console.log(err?.response, \"err?.response\");\r\n  const { status } = err?.response || {};\r\n  const { viewModel, message, statusCode } = err?.response?.data || {};\r\n  removeToken(status);\r\n  showErrorMessage(err?.message || \"Network error\");\r\n  console.log(\"wori\", statusCode, status);\r\n  if ((status || statusCode) == (405 || 500)) {\r\n    return history.replace(\"/500\");\r\n  }\r\n  return err?.response?.data;\r\n};\r\n\r\nconst hideLoader = () => {\r\n  activeRequests--;\r\n  if (!activeRequests) {\r\n    hideLoadingIndicator();\r\n  }\r\n};\r\n\r\nconst showLoader = () => {\r\n  activeRequests++;\r\n  showLoadingIndicator();\r\n};\r\n\r\nconst removeToken = (statusCode) => {\r\n  if (statusCode === 401 || statusCode === 403) {\r\n    removeData(\"accessToken\");\r\n    window.location.href = \"/auth\";\r\n  }\r\n};\r\n\r\nexport const apiRequest = async (options, auth) => {\r\n  showLoader();\r\n  // const token = await getData(\"accessToken\");\r\n  const token =  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImdhdXJhdmJsYWNrY29kZUBnbWFpbC5jb20iLCJnaXRodWIiOiJodHRwczovL2dpdGh1Yi5jb20vR2F1cmF2YmxhY2tjb2RlIiwiaWF0IjoxNjU5MzQ4MDk5LCJleHAiOjE2NTk3ODAwOTl9.bUGO31givjMT85QyKzC3V9iKdiwMQgE9pqEwZ5yZBxI'\r\n  appClient.defaults.headers[\"Authorization\"] = `Bearer ${token}`;\r\n  return appClient(options).then(onSuccess).catch(onError);\r\n};\r\n\r\nexport const apiRequestWithoutToken = async (options) => {\r\n  showLoader();\r\n  return appClient(options).then(onSuccess).catch(onError);\r\n};\r\n"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,EAAkBC,UAAlB,QAAoC,6BAApC;AACA,OAAOC,OAAP,MAAoB,iBAApB;AACA,SACEC,gBADF,EAEEC,kBAFF,EAGEC,oBAHF,EAIEC,oBAJF,QAKO,mBALP;AAOA,MAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAR,CAAYC,kBAA7B;AACA,IAAIC,cAAc,GAAG,CAArB;AAEA,MAAMC,SAAS,GAAGb,KAAK,CAACc,MAAN,CAAa;EAC7BC,OAAO,EAAEP,QADoB;EAE7BQ,OAAO,EAAE;IACP,gBAAgB;EADT;AAFoB,CAAb,CAAlB;;AAOA,MAAMC,SAAS,GAAIC,GAAD,IAAS;EACzBC,UAAU;EACV,MAAM;IAAEC;EAAF,IAAWF,GAAjB;;EACA,IAAIE,IAAJ,aAAIA,IAAJ,eAAIA,IAAI,CAAEC,OAAV,EAAmB;IACjBhB,kBAAkB,CAACe,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEC,OAAP,CAAlB;EACD,CAFD,MAEO;IACLC,WAAW,CAACF,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEG,UAAP,CAAX;IACAnB,gBAAgB,CAAC,CAAAgB,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEC,OAAN,KAAiB,eAAlB,CAAhB;EACD;;EACD,OAAO,CAAAH,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEE,IAAL,KAAaF,GAApB;AACD,CAVD;;AAYA,MAAMM,OAAO,GAAIC,GAAD,IAAS;EAAA;;EACvBN,UAAU;EACVO,OAAO,CAACC,GAAR,CAAYF,GAAZ,aAAYA,GAAZ,uBAAYA,GAAG,CAAEG,QAAjB,EAA2B,eAA3B;EACA,MAAM;IAAEC;EAAF,IAAa,CAAAJ,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEG,QAAL,KAAiB,EAApC;EACA,MAAM;IAAEE,SAAF;IAAaT,OAAb;IAAsBE;EAAtB,IAAqC,CAAAE,GAAG,SAAH,IAAAA,GAAG,WAAH,6BAAAA,GAAG,CAAEG,QAAL,gEAAeR,IAAf,KAAuB,EAAlE;EACAE,WAAW,CAACO,MAAD,CAAX;EACAzB,gBAAgB,CAAC,CAAAqB,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAEJ,OAAL,KAAgB,eAAjB,CAAhB;EACAK,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBJ,UAApB,EAAgCM,MAAhC;;EACA,IAAI,CAACA,MAAM,IAAIN,UAAX,MAA2B,OAAO,GAAlC,CAAJ,EAA4C;IAC1C,OAAOpB,OAAO,CAAC4B,OAAR,CAAgB,MAAhB,CAAP;EACD;;EACD,OAAON,GAAP,aAAOA,GAAP,yCAAOA,GAAG,CAAEG,QAAZ,mDAAO,eAAeR,IAAtB;AACD,CAZD;;AAcA,MAAMD,UAAU,GAAG,MAAM;EACvBP,cAAc;;EACd,IAAI,CAACA,cAAL,EAAqB;IACnBL,oBAAoB;EACrB;AACF,CALD;;AAOA,MAAMyB,UAAU,GAAG,MAAM;EACvBpB,cAAc;EACdN,oBAAoB;AACrB,CAHD;;AAKA,MAAMgB,WAAW,GAAIC,UAAD,IAAgB;EAClC,IAAIA,UAAU,KAAK,GAAf,IAAsBA,UAAU,KAAK,GAAzC,EAA8C;IAC5CrB,UAAU,CAAC,aAAD,CAAV;IACA+B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,OAAvB;EACD;AACF,CALD;;AAOA,OAAO,MAAMC,UAAU,GAAG,OAAOC,OAAP,EAAgBC,IAAhB,KAAyB;EACjDN,UAAU,GADuC,CAEjD;;EACA,MAAMO,KAAK,GAAI,+OAAf;EACA1B,SAAS,CAAC2B,QAAV,CAAmBxB,OAAnB,CAA2B,eAA3B,IAA+C,UAASuB,KAAM,EAA9D;EACA,OAAO1B,SAAS,CAACwB,OAAD,CAAT,CAAmBI,IAAnB,CAAwBxB,SAAxB,EAAmCyB,KAAnC,CAAyClB,OAAzC,CAAP;AACD,CANM;AAQP,OAAO,MAAMmB,sBAAsB,GAAG,MAAON,OAAP,IAAmB;EACvDL,UAAU;EACV,OAAOnB,SAAS,CAACwB,OAAD,CAAT,CAAmBI,IAAnB,CAAwBxB,SAAxB,EAAmCyB,KAAnC,CAAyClB,OAAzC,CAAP;AACD,CAHM"},"metadata":{},"sourceType":"module"}